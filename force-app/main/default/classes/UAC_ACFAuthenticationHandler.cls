//TODO:This autogenerated class includes the basics for a Registration
//Handler class. You will need to customize it to ensure it meets your needs and
//the data provided by the third party.

global without sharing class UAC_ACFAuthenticationHandler implements Auth.RegistrationHandler{
    global boolean canCreateUser(Auth.UserData data) {    
       if(data.email!=null)
       {
           system.debug(data.email);
            return true;
       }
       else
       {
           return false;
       }
    }
    
    global User createUser(Id portalId, Auth.UserData data){
        system.debug(data);
        if(canCreateUser(data)) {
            system.debug(data.attributeMap);
            //Returning null or throwing an exception fails the SSO flow
            //List<User> users = [Select Id from User where ACF_Auth_Id__c=:data.identifier];
            List<User> users = [Select Id from User where UAC_ORRAuthorizedUser__c =true and UAC_ACFHHSID__c=:data.attributeMap.get('email')];            
            if(users.size()==1)
            {
               return users[0];              
            }    
            else {
                return null;
            }
        }
        else
        {  
            return null;        
        }
        
    }
    
    
    global void updateUser(Id userId, Id portalId, Auth.UserData data){
    }
}